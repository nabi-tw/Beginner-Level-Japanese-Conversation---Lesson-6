{\rtf1\ansi\ansicpg932\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 <!DOCTYPE html>\
<html lang="ja">\
<head>\
    <meta charset="UTF-8">\
    <meta name="viewport" content="width=device-width, initial-scale=1.0">\
    <title>\uc0\u26085 \u26412 \u35486 \u20250 \u35441 \u32244 \u32722 \u12459 \u12540 \u12489 \u12466 \u12540 \u12512 </title>\
    <style>\
        body \{\
            font-family: 'Noto Sans JP', sans-serif;\
            background-color: #f0f8ff;\
            margin: 0;\
            padding: 20px;\
            display: flex;\
            justify-content: center;\
            align-items: center;\
            min-height: 100vh;\
        \}\
        \
        .game-container \{\
            background-color: white;\
            border-radius: 20px;\
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);\
            padding: 30px;\
            max-width: 600px;\
            width: 100%;\
        \}\
        \
        h1 \{\
            color: #ff6b6b;\
            text-align: center;\
            margin-bottom: 30px;\
        \}\
        \
        .card \{\
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\
            color: white;\
            padding: 20px;\
            border-radius: 15px;\
            margin-bottom: 20px;\
            text-align: center;\
            font-size: 1.2em;\
            cursor: pointer;\
            transition: transform 0.3s;\
        \}\
        \
        .card:hover \{\
            transform: translateY(-5px);\
        \}\
        \
        .chat-area \{\
            background-color: #f5f5f5;\
            border-radius: 10px;\
            padding: 20px;\
            height: 300px;\
            overflow-y: auto;\
            margin-bottom: 20px;\
        \}\
        \
        .message \{\
            margin: 10px 0;\
            padding: 10px;\
            border-radius: 10px;\
        \}\
        \
        .bot-message \{\
            background-color: #e3f2fd;\
            text-align: left;\
        \}\
        \
        .user-message \{\
            background-color: #e8f5e9;\
            text-align: right;\
            margin-left: 50px;\
        \}\
        \
        .correction \{\
            background-color: #fff3cd;\
            border-left: 4px solid #ffc107;\
            margin: 10px 0;\
            padding: 10px;\
        \}\
        \
        .input-area \{\
            display: flex;\
            gap: 10px;\
        \}\
        \
        input[type="text"] \{\
            flex: 1;\
            padding: 10px;\
            border: 2px solid #ddd;\
            border-radius: 5px;\
            font-size: 16px;\
        \}\
        \
        button \{\
            background-color: #4CAF50;\
            color: white;\
            border: none;\
            padding: 10px 20px;\
            border-radius: 5px;\
            cursor: pointer;\
            font-size: 16px;\
            transition: background-color 0.3s;\
        \}\
        \
        button:hover \{\
            background-color: #45a049;\
        \}\
        \
        .new-topic-btn \{\
            background-color: #ff6b6b;\
            margin-top: 10px;\
            width: 100%;\
        \}\
        \
        .new-topic-btn:hover \{\
            background-color: #ff5252;\
        \}\
        \
        .progress \{\
            text-align: center;\
            color: #666;\
            margin-top: 10px;\
            font-size: 0.9em;\
        \}\
        \
        .reset-btn \{\
            background-color: #9c27b0;\
            margin-top: 10px;\
            width: 100%;\
        \}\
        \
        .reset-btn:hover \{\
            background-color: #7b1fa2;\
        \}\
    </style>\
</head>\
<body>\
    <div class="game-container">\
        <h1>\uc0\u55356 \u57228  \u26085 \u26412 \u35486 \u20250 \u35441 \u32244 \u32722 \u12459 \u12540 \u12489 \u12466 \u12540 \u12512  \u55356 \u57228 </h1>\
        \
        <div class="card" id="questionCard">\
            \uc0\u12463 \u12522 \u12483 \u12463 \u12375 \u12390 \u36074 \u21839 \u12459 \u12540 \u12489 \u12434 \u24341 \u12367 \u65281 \
        </div>\
        \
        <div class="chat-area" id="chatArea">\
            <!-- \uc0\u12481 \u12515 \u12483 \u12488 \u12513 \u12483 \u12475 \u12540 \u12472 \u12364 \u12371 \u12371 \u12395 \u34920 \u31034 \u12373 \u12428 \u12414 \u12377  -->\
        </div>\
        \
        <div class="input-area">\
            <input type="text" id="userInput" placeholder="\uc0\u12371 \u12371 \u12395 \u31572 \u12360 \u12434 \u26360 \u12356 \u12390 \u12367 \u12384 \u12373 \u12356 ..." disabled>\
            <button id="sendBtn" disabled>\uc0\u36865 \u20449 </button>\
        </div>\
        \
        <button class="new-topic-btn" id="newTopicBtn" style="display:none;">\uc0\u32244 \u32722 \u24471 \u19981 \u37679 \u21908 \u65281 \u37027 \u25105 \u20497 \u20358 \u35430 \u35430 \u19979 \u19968 \u38988 \u22909 \u21966 \u65311 </button>\
        \
        <div class="progress" id="progress"></div>\
        \
        <button class="reset-btn" id="resetBtn" style="display:none;">\uc0\u12377 \u12409 \u12390 \u12398 \u36074 \u21839 \u12434 \u12522 \u12475 \u12483 \u12488 </button>\
    </div>\
\
    <script>\
        class JapaneseConversationBot \{\
            constructor() \{\
                this.allQuestions = [\
                    "\uc0\u12371 \u12435 \u12395 \u12385 \u12399 \u12290 \u12362 \u21517 \u21069 \u12399 \u20309 \u12391 \u12377 \u12363 \u65311 ",\
                    "\uc0\u12365 \u12423 \u12358 \u12399 \u20309 \u26332 \u26085 \u12391 \u12377 \u12363 \u65311 ",\
                    "\uc0\u12393 \u12371 \u12391 \u12372 \u12399 \u12435 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u12356 \u12387 \u12375 \u12423 \u12395 \u26144 \u30011 \u12434 \u35211 \u12414 \u12379 \u12435 \u12363 \u65311 ",\
                    "\uc0\u12365 \u12398 \u12358 \u12289 \u20309 \u12434 \u12375 \u12414 \u12375 \u12383 \u12363 \u65311 ",\
                    "\uc0\u20309 \u26178 \u12395 \u36215 \u12365 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u12358 \u12385 \u12399 \u12393 \u12371 \u12391 \u12377 \u12363 \u65311 ",\
                    "\uc0\u12393 \u12371 \u12391 \u26085 \u26412 \u35486 \u12434 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u36913 \u26411 \u12395 \u20309 \u12434 \u12375 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u20309 \u26178 \u12395 \u23517 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u26397 \u12372 \u12399 \u12435 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u23398 \u26657 \u12399 \u12393 \u12371 \u12391 \u12377 \u12363 \u65311 ",\
                    "\uc0\u12354 \u12375 \u12383 \u12289 \u12393 \u12371 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u12467 \u12540 \u12498 \u12540 \u12434 \u39154 \u12415 \u12414 \u12379 \u12435 \u12363 \u65311 ",\
                    "\uc0\u23398 \u26657 \u12399 \u20309 \u26178 \u12363 \u12425 \u20309 \u26178 \u12414 \u12391 \u12391 \u12377 \u12363 \u65311 ",\
                    "\uc0\u26085 \u26412 \u12398 \u39135 \u12409 \u29289 \u12434 \u39135 \u12409 \u12414 \u12375 \u12383 \u12363 \u65311 ",\
                    "\uc0\u20309 \u12391 \u23398 \u26657 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u12365 \u12423 \u12358 \u12289 \u20309 \u26178 \u12395 \u23478 \u12408 \u24112 \u12426 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u20309 \u12434 \u36023 \u12356 \u12414 \u12377 \u12363 \u65311 ",\
                    "\uc0\u26412 \u12434 \u35501 \u12415 \u12414 \u12377 \u12363 \u65311 "\
                ];\
                \
                this.usedQuestions = this.loadUsedQuestions();\
                this.availableQuestions = this.getAvailableQuestions();\
                \
                this.currentQuestion = "";\
                this.conversationTurn = 0;\
                this.maxTurns = 5;\
                \
                // \uc0\u20250 \u35441 \u31649 \u29702 \
                this.conversationHistory = [];\
                this.allAskedQuestions = new Set(); // \uc0\u20170 \u12414 \u12391 \u12395 \u32862 \u12356 \u12383 \u12377 \u12409 \u12390 \u12398 \u36074 \u21839 \
                this.extractedInfo = \{\}; // \uc0\u25277 \u20986 \u12375 \u12383 \u24773 \u22577 \
                this.negativeCount = 0;\
            \}\
            \
            loadUsedQuestions() \{\
                const saved = localStorage.getItem('usedQuestions');\
                return saved ? JSON.parse(saved) : [];\
            \}\
            \
            saveUsedQuestions() \{\
                localStorage.setItem('usedQuestions', JSON.stringify(this.usedQuestions));\
            \}\
            \
            getAvailableQuestions() \{\
                return this.allQuestions.filter(q => !this.usedQuestions.includes(q));\
            \}\
            \
            resetQuestions() \{\
                this.usedQuestions = [];\
                this.availableQuestions = [...this.allQuestions];\
                localStorage.removeItem('usedQuestions');\
            \}\
            \
            getRandomQuestion() \{\
                if (this.availableQuestions.length === 0) \{\
                    return null;\
                \}\
                \
                const index = Math.floor(Math.random() * this.availableQuestions.length);\
                const question = this.availableQuestions[index];\
                \
                this.usedQuestions.push(question);\
                this.saveUsedQuestions();\
                \
                this.availableQuestions = this.availableQuestions.filter(q => q !== question);\
                \
                return question;\
            \}\
            \
            getProgress() \{\
                return \{\
                    used: this.usedQuestions.length,\
                    total: this.allQuestions.length,\
                    remaining: this.availableQuestions.length\
                \};\
            \}\
            \
            extractVerb(userInput) \{\
                const verbPatterns = [\
                    \{ pattern: /\uc0\u21193 \u24375 \u12375 \u12414 \u12377 /, verb: "\u21193 \u24375 \u12375 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u35211 \u12414 \u12377 /, verb: "\u35211 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u39135 \u12409 \u12414 \u12377 /, verb: "\u39135 \u12409 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u39154 \u12415 \u12414 \u12377 /, verb: "\u39154 \u12415 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u34892 \u12365 \u12414 \u12377 /, verb: "\u34892 \u12365 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u26469 \u12414 \u12377 /, verb: "\u26469 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u24112 \u12426 \u12414 \u12377 /, verb: "\u24112 \u12426 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u12375 \u12414 \u12377 /, verb: "\u12375 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u36023 \u12356 \u12414 \u12377 /, verb: "\u36023 \u12356 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u35501 \u12415 \u12414 \u12377 /, verb: "\u35501 \u12415 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u26360 \u12365 \u12414 \u12377 /, verb: "\u26360 \u12365 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u32862 \u12365 \u12414 \u12377 /, verb: "\u32862 \u12365 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u36215 \u12365 \u12414 \u12377 /, verb: "\u36215 \u12365 \u12414 \u12377 " \},\
                    \{ pattern: /\uc0\u23517 \u12414 \u12377 /, verb: "\u23517 \u12414 \u12377 " \}\
                ];\
                \
                const sortedPatterns = verbPatterns.sort((a, b) => b.verb.length - a.verb.length);\
                \
                for (let vp of sortedPatterns) \{\
                    if (userInput.match(vp.pattern)) \{\
                        return vp.verb;\
                    \}\
                \}\
                \
                return null;\
            \}\
            \
            convertToPast(verb) \{\
                const conversions = \{\
                    "\uc0\u35211 \u12414 \u12377 ": "\u35211 \u12414 \u12375 \u12383 ",\
                    "\uc0\u39135 \u12409 \u12414 \u12377 ": "\u39135 \u12409 \u12414 \u12375 \u12383 ",\
                    "\uc0\u39154 \u12415 \u12414 \u12377 ": "\u39154 \u12415 \u12414 \u12375 \u12383 ",\
                    "\uc0\u34892 \u12365 \u12414 \u12377 ": "\u34892 \u12365 \u12414 \u12375 \u12383 ",\
                    "\uc0\u26469 \u12414 \u12377 ": "\u26469 \u12414 \u12375 \u12383 ",\
                    "\uc0\u24112 \u12426 \u12414 \u12377 ": "\u24112 \u12426 \u12414 \u12375 \u12383 ",\
                    "\uc0\u12375 \u12414 \u12377 ": "\u12375 \u12414 \u12375 \u12383 ",\
                    "\uc0\u21193 \u24375 \u12375 \u12414 \u12377 ": "\u21193 \u24375 \u12375 \u12414 \u12375 \u12383 ",\
                    "\uc0\u36023 \u12356 \u12414 \u12377 ": "\u36023 \u12356 \u12414 \u12375 \u12383 ",\
                    "\uc0\u35501 \u12415 \u12414 \u12377 ": "\u35501 \u12415 \u12414 \u12375 \u12383 ",\
                    "\uc0\u26360 \u12365 \u12414 \u12377 ": "\u26360 \u12365 \u12414 \u12375 \u12383 ",\
                    "\uc0\u32862 \u12365 \u12414 \u12377 ": "\u32862 \u12365 \u12414 \u12375 \u12383 ",\
                    "\uc0\u36215 \u12365 \u12414 \u12377 ": "\u36215 \u12365 \u12414 \u12375 \u12383 ",\
                    "\uc0\u23517 \u12414 \u12377 ": "\u23517 \u12414 \u12375 \u12383 "\
                \};\
                \
                return conversions[verb] || verb;\
            \}\
            \
            extractInformation(userInput) \{\
                // \uc0\u20132 \u36890 \u25163 \u27573 \
                if (userInput.includes("\uc0\u12496 \u12473 ") || userInput.includes("\u38651 \u36554 ") || \
                    userInput.includes("\uc0\u33258 \u36578 \u36554 ") || userInput.includes("\u27497 \u12356 \u12390 ") || \
                    userInput.includes("\uc0\u36554 ")) \{\
                    this.extractedInfo.transport = true;\
                \}\
                \
                // \uc0\u26178 \u38291 \
                if (userInput.match(/\\d+\uc0\u26178 /)) \{\
                    this.extractedInfo.time = true;\
                \}\
                \
                // \uc0\u22580 \u25152 \
                if (userInput.includes("\uc0\u12391 ") || userInput.includes("\u12408 ") || userInput.includes("\u12395 ")) \{\
                    this.extractedInfo.place = true;\
                \}\
                \
                // \uc0\u20154 \
                if (userInput.includes("\uc0\u12392 ") || userInput.includes("\u19968 \u20154 \u12391 ") || userInput.includes("\u12402 \u12392 \u12426 \u12391 ")) \{\
                    this.extractedInfo.person = true;\
                \}\
            \}\
            \
            checkGrammar(userInput) \{\
                const corrections = [];\
                const currentQ = this.conversationHistory.length > 0 \
                    ? this.conversationHistory[this.conversationHistory.length - 1].question \
                    : this.currentQuestion;\
                \
                if (userInput.trim() === "\uc0\u12356 \u12356 \u12360 ") \{\
                    if (currentQ.includes("\uc0\u39135 \u12409 \u12414 \u12377 \u12363 ")) \{\
                        corrections.push(\{\
                            error: "\uc0\u12356 \u12356 \u12360 ",\
                            correction: "\uc0\u12356 \u12356 \u12360 \u12289 \u39135 \u12409 \u12414 \u12379 \u12435 ",\
                            explanation: "\uc0\u12300 \u12356 \u12356 \u12360 \u12301 \u12398 \u24460 \u12395 \u21205 \u35422 \u12398 \u21542 \u23450 \u24418 \u12434 \u20351 \u12387 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 "\
                        \});\
                    \} else if (currentQ.includes("\uc0\u39154 \u12415 \u12414 \u12377 \u12363 ")) \{\
                        corrections.push(\{\
                            error: "\uc0\u12356 \u12356 \u12360 ",\
                            correction: "\uc0\u12356 \u12356 \u12360 \u12289 \u39154 \u12415 \u12414 \u12379 \u12435 ",\
                            explanation: "\uc0\u12300 \u12356 \u12356 \u12360 \u12301 \u12398 \u24460 \u12395 \u21205 \u35422 \u12398 \u21542 \u23450 \u24418 \u12434 \u20351 \u12387 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 "\
                        \});\
                    \} else if (currentQ.includes("\uc0\u12375 \u12414 \u12377 \u12363 ")) \{\
                        corrections.push(\{\
                            error: "\uc0\u12356 \u12356 \u12360 ",\
                            correction: "\uc0\u12356 \u12356 \u12360 \u12289 \u12375 \u12414 \u12379 \u12435 ",\
                            explanation: "\uc0\u12300 \u12356 \u12356 \u12360 \u12301 \u12398 \u24460 \u12395 \u21205 \u35422 \u12398 \u21542 \u23450 \u24418 \u12434 \u20351 \u12387 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 "\
                        \});\
                    \} else if (currentQ.includes("\uc0\u34892 \u12365 \u12414 \u12377 \u12363 ")) \{\
                        corrections.push(\{\
                            error: "\uc0\u12356 \u12356 \u12360 ",\
                            correction: "\uc0\u12356 \u12356 \u12360 \u12289 \u34892 \u12365 \u12414 \u12379 \u12435 ",\
                            explanation: "\uc0\u12300 \u12356 \u12356 \u12360 \u12301 \u12398 \u24460 \u12395 \u21205 \u35422 \u12398 \u21542 \u23450 \u24418 \u12434 \u20351 \u12387 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 "\
                        \});\
                    \} else if (currentQ.includes("\uc0\u35501 \u12415 \u12414 \u12377 \u12363 ")) \{\
                        corrections.push(\{\
                            error: "\uc0\u12356 \u12356 \u12360 ",\
                            correction: "\uc0\u12356 \u12356 \u12360 \u12289 \u35501 \u12415 \u12414 \u12379 \u12435 ",\
                            explanation: "\uc0\u12300 \u12356 \u12356 \u12360 \u12301 \u12398 \u24460 \u12395 \u21205 \u35422 \u12398 \u21542 \u23450 \u24418 \u12434 \u20351 \u12387 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 "\
                        \});\
                    \}\
                \}\
                \
                if (userInput.includes("\uc0\u12434 ") && userInput.includes("\u34892 \u12365 \u12414 \u12377 ")) \{\
                    corrections.push(\{\
                        error: "\uc0\u12434 \u34892 \u12365 \u12414 \u12377 ",\
                        correction: "\uc0\u12408 \u34892 \u12365 \u12414 \u12377 \u65295 \u12395 \u34892 \u12365 \u12414 \u12377 ",\
                        explanation: "\uc0\u22580 \u25152 \u12408 \u34892 \u12367 \u12392 \u12365 \u12399 \u12300 \u12408 \u12301 \u12363 \u12300 \u12395 \u12301 \u12434 \u20351 \u12356 \u12414 \u12377 \u12290 "\
                    \});\
                \}\
                \
                return corrections;\
            \}\
            \
            generateResponse(userInput) \{\
                const corrections = this.checkGrammar(userInput);\
                let response = "";\
                \
                if (corrections.length > 0) \{\
                    response = `\uc0\u12385 \u12423 \u12387 \u12392 \u12385 \u12364 \u12356 \u12414 \u12377 \u12290 \u12300 $\{corrections[0].correction\}\u12301 \u12364 \u12356 \u12356 \u12391 \u12377 \u12397 \u12290 $\{corrections[0].explanation\}\\n\\n`;\
                \}\
                \
                // \uc0\u24773 \u22577 \u12434 \u25277 \u20986 \
                this.extractInformation(userInput);\
                \
                // \uc0\u20250 \u35441 \u23653 \u27508 \u12395 \u36861 \u21152 \
                const currentQ = this.conversationHistory.length > 0 \
                    ? this.conversationHistory[this.conversationHistory.length - 1].question \
                    : this.currentQuestion;\
                    \
                this.conversationHistory.push(\{\
                    question: currentQ,\
                    answer: userInput\
                \});\
                \
                this.conversationTurn++;\
                \
                if (this.conversationTurn >= this.maxTurns) \{\
                    response += "\uc0\u12356 \u12356 \u32244 \u32722 \u12391 \u12375 \u12383 \u12397 \u65281 \u12376 \u12419 \u12289 \u12388 \u12366 \u12398 \u36074 \u21839 \u12434 \u12375 \u12390 \u12418 \u12356 \u12356 \u12391 \u12377 \u12363 \u65311 ";\
                    this.resetConversation();\
                \} else \{\
                    const followUpQuestion = this.getSmartFollowUpQuestion(userInput);\
                    \
                    if (followUpQuestion) \{\
                        response += followUpQuestion.prefix + followUpQuestion.question;\
                        this.allAskedQuestions.add(followUpQuestion.question);\
                        \
                        // \uc0\u27425 \u12398 \u36074 \u21839 \u12392 \u12375 \u12390 \u35352 \u37682 \
                        this.conversationHistory.push(\{\
                            question: followUpQuestion.question,\
                            answer: null // \uc0\u12414 \u12384 \u31572 \u12360 \u12390 \u12356 \u12394 \u12356 \
                        \});\
                    \} else \{\
                        response += "\uc0\u12356 \u12356 \u32244 \u32722 \u12391 \u12375 \u12383 \u12397 \u65281 ";\
                        this.conversationTurn = this.maxTurns;\
                    \}\
                \}\
                \
                return response;\
            \}\
            \
            getSmartFollowUpQuestion(userInput) \{\
                const lastQuestion = this.conversationHistory[this.conversationHistory.length - 1].question;\
                const negativePatterns = ['\uc0\u12414 \u12379 \u12435 ', '\u12394 \u12356 ', '\u12356 \u12356 \u12360 ', '\u12376 \u12419 \u12354 \u12426 \u12414 \u12379 \u12435 '];\
                const isNegative = negativePatterns.some(pattern => userInput.includes(pattern));\
                \
                if (isNegative) \{\
                    this.negativeCount++;\
                \} else \{\
                    this.negativeCount = 0;\
                \}\
                \
                if (this.negativeCount >= 3) \{\
                    return null;\
                \}\
                \
                // \uc0\u12377 \u12391 \u12395 \u32862 \u12356 \u12383 \u36074 \u21839 \u12434 \u12481 \u12455 \u12483 \u12463 \
                const hasAsked = (question) => \{\
                    return this.allAskedQuestions.has(question) || \
                           this.conversationHistory.some(h => h.question === question);\
                \};\
                \
                // \uc0\u36074 \u21839 \u12497 \u12479 \u12540 \u12531 \u12372 \u12392 \u12398 \u20966 \u29702 \
                if (lastQuestion.includes("\uc0\u12362 \u21517 \u21069 \u12399 \u20309 \u12391 \u12377 \u12363 ")) \{\
                    if (!hasAsked("\uc0\u23398 \u26657 \u12399 \u12393 \u12371 \u12391 \u12377 \u12363 \u65311 ")) \{\
                        return \{ prefix: "\uc0\u12399 \u12376 \u12417 \u12414 \u12375 \u12390 \u12290 ", question: "\u23398 \u26657 \u12399 \u12393 \u12371 \u12391 \u12377 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u12365 \u12423 \u12358 \u12399 \u20309 \u26332 \u26085 \u12391 \u12377 \u12363 ")) \{\
                    if (!hasAsked("\uc0\u12365 \u12423 \u12358 \u12399 \u20309 \u12434 \u12375 \u12414 \u12377 \u12363 \u65311 ")) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12397 \u12290 ", question: "\u12365 \u12423 \u12358 \u12399 \u20309 \u12434 \u12375 \u12414 \u12377 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u12393 \u12371 \u12391 \u12372 \u12399 \u12435 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 ")) \{\
                    if (userInput.includes("\uc0\u19968 \u20154 \u12391 ") || userInput.includes("\u12402 \u12392 \u12426 \u12391 ")) \{\
                        if (!hasAsked("\uc0\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else if (userInput.includes("\uc0\u12392 ")) \{\
                        if (!hasAsked("\uc0\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: "\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else if (userInput.includes("\uc0\u23478 ") || userInput.includes("\u12358 \u12385 ")) \{\
                        if (!hasAsked("\uc0\u12384 \u12428 \u12392 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u12384 \u12428 \u12392 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else \{\
                        if (!hasAsked("\uc0\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: "\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u12356 \u12387 \u12375 \u12423 \u12395 \u26144 \u30011 \u12434 \u35211 \u12414 \u12379 \u12435 \u12363 ")) \{\
                    if (isNegative) \{\
                        if (!hasAsked("\uc0\u12362 \u33590 \u12434 \u39154 \u12415 \u12414 \u12379 \u12435 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 \u12376 \u12419 \u12289 ", question: "\u12362 \u33590 \u12434 \u39154 \u12415 \u12414 \u12379 \u12435 \u12363 \u65311 " \};\
                        \}\
                    \} else \{\
                        if (!hasAsked("\uc0\u12393 \u12371 \u12391 \u35211 \u12414 \u12375 \u12423 \u12358 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u65281 ", question: "\u12393 \u12371 \u12391 \u35211 \u12414 \u12375 \u12423 \u12358 \u12363 \u65311 " \};\
                        \}\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u12365 \u12398 \u12358 \u12289 \u20309 \u12434 \u12375 \u12414 \u12375 \u12383 \u12363 ")) \{\
                    if (isNegative || userInput.includes("\uc0\u20309 \u12418 ")) \{\
                        if (!hasAsked("\uc0\u12365 \u12423 \u12358 \u12399 \u20309 \u12434 \u12375 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u12365 \u12423 \u12358 \u12399 \u20309 \u12434 \u12375 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else if (userInput.includes("\uc0\u21193 \u24375 ")) \{\
                        if (!hasAsked("\uc0\u20309 \u12434 \u21193 \u24375 \u12375 \u12414 \u12375 \u12383 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u20309 \u12434 \u21193 \u24375 \u12375 \u12414 \u12375 \u12383 \u12363 \u65311 " \};\
                        \}\
                    \} else \{\
                        if (!hasAsked("\uc0\u12393 \u12371 \u12391 \u12375 \u12414 \u12375 \u12383 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u12393 \u12371 \u12391 \u12375 \u12414 \u12375 \u12383 \u12363 \u65311 " \};\
                        \}\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u20309 \u26178 \u12395 \u36215 \u12365 \u12414 \u12377 \u12363 ")) \{\
                    if (!hasAsked("\uc0\u26397 \u12372 \u12399 \u12435 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 ")) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u26397 \u12372 \u12399 \u12435 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u20309 \u26178 \u12395 \u23517 \u12414 \u12377 \u12363 ")) \{\
                    if (!hasAsked("\uc0\u26397 \u12289 \u20309 \u26178 \u12395 \u36215 \u12365 \u12414 \u12377 \u12363 \u65311 ")) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u26397 \u12289 \u20309 \u26178 \u12395 \u36215 \u12365 \u12414 \u12377 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u26397 \u12372 \u12399 \u12435 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 ")) \{\
                    if (isNegative) \{\
                        if (!hasAsked("\uc0\u12467 \u12540 \u12498 \u12540 \u12434 \u39154 \u12415 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u12467 \u12540 \u12498 \u12540 \u12434 \u39154 \u12415 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else \{\
                        if (!hasAsked("\uc0\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: "\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u12467 \u12540 \u12498 \u12540 \u12434 \u39154 \u12415 \u12414 \u12377 \u12363 ")) \{\
                    if (isNegative) \{\
                        if (!hasAsked("\uc0\u12362 \u33590 \u12434 \u39154 \u12415 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u12362 \u33590 \u12434 \u39154 \u12415 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else \{\
                        if (!hasAsked("\uc0\u12393 \u12371 \u12391 \u39154 \u12415 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: "\u12393 \u12371 \u12391 \u39154 \u12415 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u12393 \u12371 \u12391 \u26085 \u26412 \u35486 \u12434 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 ")) \{\
                    if (userInput.includes("\uc0\u22654 ") || userInput.includes("\u23398 \u26657 ")) \{\
                        if (!hasAsked("\uc0\u20309 \u26178 \u12363 \u12425 \u20309 \u26178 \u12414 \u12391 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 \u65311 ") && !this.extractedInfo.time) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u20309 \u26178 \u12363 \u12425 \u20309 \u26178 \u12414 \u12391 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 \u65311 " \};\
                        \} else if (!hasAsked("\uc0\u27598 \u26085 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u27598 \u26085 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else \{\
                        if (!hasAsked("\uc0\u27598 \u26085 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u27598 \u26085 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u36913 \u26411 \u12395 \u20309 \u12434 \u12375 \u12414 \u12377 \u12363 ")) \{\
                    const verb = this.extractVerb(userInput);\
                    if (userInput.includes("\uc0\u26144 \u30011 \u12434 \u35211 \u12414 \u12377 ")) \{\
                        if (userInput.includes("\uc0\u12392 ")) \{\
                            if (!hasAsked("\uc0\u12393 \u12371 \u12391 \u35211 \u12414 \u12377 \u12363 \u65311 ")) \{\
                                return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: "\u12393 \u12371 \u12391 \u35211 \u12414 \u12377 \u12363 \u65311 " \};\
                            \}\
                        \} else if (!hasAsked("\uc0\u12384 \u12428 \u12392 \u35211 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: "\u12384 \u12428 \u12392 \u35211 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else if (userInput.includes("\uc0\u21193 \u24375 ")) \{\
                        if (!hasAsked("\uc0\u12393 \u12371 \u12391 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u12393 \u12371 \u12391 \u21193 \u24375 \u12375 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else if (userInput.includes("\uc0\u19968 \u20154 \u12391 ")) \{\
                        if (verb && verb !== "\uc0\u12375 \u12414 \u12377 " && !hasAsked(`\u12393 \u12371 \u12391 $\{verb\}\u12363 \u65311 `)) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: `\u12393 \u12371 \u12391 $\{verb\}\u12363 \u65311 ` \};\
                        \}\
                    \} else if (!userInput.includes("\uc0\u12392 ") && !this.extractedInfo.person) \{\
                        if (verb && verb !== "\uc0\u12375 \u12414 \u12377 " && !hasAsked(`\u12384 \u12428 \u12392 $\{verb\}\u12363 \u65311 `)) \{\
                            return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: `\u12384 \u12428 \u12392 $\{verb\}\u12363 \u65311 ` \};\
                        \}\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u23398 \u26657 \u12399 \u12393 \u12371 \u12391 \u12377 \u12363 ")) \{\
                    if (!hasAsked("\uc0\u20309 \u12391 \u23398 \u26657 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 ") && !this.extractedInfo.transport) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u20309 \u12391 \u23398 \u26657 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 " \};\
                    \} else if (!hasAsked("\uc0\u20309 \u26178 \u12395 \u23398 \u26657 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 ") && !this.extractedInfo.time) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u20309 \u26178 \u12395 \u23398 \u26657 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u20309 \u12391 \u23398 \u26657 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 ")) \{\
                    if (!hasAsked("\uc0\u20309 \u26178 \u12395 \u23398 \u26657 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 ") && !this.extractedInfo.time) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u20309 \u26178 \u12395 \u23398 \u26657 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 " \};\
                    \} else if (!hasAsked("\uc0\u23398 \u26657 \u12399 \u20309 \u26178 \u12363 \u12425 \u20309 \u26178 \u12414 \u12391 \u12391 \u12377 \u12363 \u65311 ")) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u23398 \u26657 \u12399 \u20309 \u26178 \u12363 \u12425 \u20309 \u26178 \u12414 \u12391 \u12391 \u12377 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u12354 \u12375 \u12383 \u12289 \u12393 \u12371 \u12408 \u34892 \u12365 \u12414 \u12377 \u12363 ")) \{\
                    if (userInput.includes("\uc0\u20250 \u31038 ") || userInput.includes("\u23398 \u26657 ")) \{\
                        if (!hasAsked("\uc0\u20309 \u26178 \u12395 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u20309 \u26178 \u12395 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else if (!hasAsked("\uc0\u12384 \u12428 \u12392 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 ") && !this.extractedInfo.person) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u12384 \u12428 \u12392 \u34892 \u12365 \u12414 \u12377 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u26085 \u26412 \u12398 \u39135 \u12409 \u29289 \u12434 \u39135 \u12409 \u12414 \u12375 \u12383 \u12363 ")) \{\
                    if (isNegative) \{\
                        if (!hasAsked("\uc0\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u20309 \u12434 \u39135 \u12409 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else \{\
                        if (!hasAsked("\uc0\u20309 \u12434 \u39135 \u12409 \u12414 \u12375 \u12383 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: "\u20309 \u12434 \u39135 \u12409 \u12414 \u12375 \u12383 \u12363 \u65311 " \};\
                        \}\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u20309 \u12434 \u39135 \u12409 \u12414 \u12375 \u12383 \u12363 ")) \{\
                    if (!hasAsked("\uc0\u12393 \u12371 \u12391 \u39135 \u12409 \u12414 \u12375 \u12383 \u12363 \u65311 ")) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u12393 \u12371 \u12391 \u39135 \u12409 \u12414 \u12375 \u12383 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u12365 \u12423 \u12358 \u12289 \u20309 \u26178 \u12395 \u23478 \u12408 \u24112 \u12426 \u12414 \u12377 \u12363 ")) \{\
                    if (!hasAsked("\uc0\u12384 \u12428 \u12392 \u24112 \u12426 \u12414 \u12377 \u12363 \u65311 ") && !this.extractedInfo.person) \{\
                        return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u12384 \u12428 \u12392 \u24112 \u12426 \u12414 \u12377 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u20309 \u12434 \u36023 \u12356 \u12414 \u12377 \u12363 ")) \{\
                    if (!hasAsked("\uc0\u12393 \u12371 \u12391 \u36023 \u12356 \u12414 \u12377 \u12363 \u65311 ")) \{\
                        return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: "\u12393 \u12371 \u12391 \u36023 \u12356 \u12414 \u12377 \u12363 \u65311 " \};\
                    \}\
                \}\
                \
                if (lastQuestion.includes("\uc0\u26412 \u12434 \u35501 \u12415 \u12414 \u12377 \u12363 ")) \{\
                    if (isNegative) \{\
                        if (!hasAsked("\uc0\u26032 \u32862 \u12434 \u35501 \u12415 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12381 \u12358 \u12391 \u12377 \u12363 \u12290 ", question: "\u26032 \u32862 \u12434 \u35501 \u12415 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \} else \{\
                        if (!hasAsked("\uc0\u20309 \u12398 \u26412 \u12434 \u35501 \u12415 \u12414 \u12377 \u12363 \u65311 ")) \{\
                            return \{ prefix: "\uc0\u12356 \u12356 \u12391 \u12377 \u12397 \u12290 ", question: "\u20309 \u12398 \u26412 \u12434 \u35501 \u12415 \u12414 \u12377 \u12363 \u65311 " \};\
                        \}\
                    \}\
                \}\
                \
                return null;\
            \}\
            \
            resetConversation() \{\
                this.conversationHistory = [];\
                this.allAskedQuestions.clear();\
                this.extractedInfo = \{\};\
                this.negativeCount = 0;\
            \}\
        \}\
        \
        // \uc0\u12466 \u12540 \u12512 \u12398 \u21021 \u26399 \u21270 \
        const bot = new JapaneseConversationBot();\
        const questionCard = document.getElementById('questionCard');\
        const chatArea = document.getElementById('chatArea');\
        const userInput = document.getElementById('userInput');\
        const sendBtn = document.getElementById('sendBtn');\
        const newTopicBtn = document.getElementById('newTopicBtn');\
        const progressDiv = document.getElementById('progress');\
        const resetBtn = document.getElementById('resetBtn');\
        \
        function updateProgress() \{\
            const progress = bot.getProgress();\
            progressDiv.textContent = `\uc0\u36074 \u21839 : $\{progress.used\}/$\{progress.total\} \u23436 \u20102  (\u27531 \u12426 : $\{progress.remaining\})`;\
            \
            if (progress.remaining === 0) \{\
                questionCard.textContent = '\uc0\u12377 \u12409 \u12390 \u12398 \u36074 \u21839 \u12434 \u23436 \u20102 \u12375 \u12414 \u12375 \u12383 \u65281 \u55356 \u57225 ';\
                questionCard.style.pointerEvents = 'none';\
                resetBtn.style.display = 'block';\
            \}\
        \}\
        \
        updateProgress();\
        \
        questionCard.addEventListener('click', () => \{\
            const question = bot.getRandomQuestion();\
            \
            if (question === null) \{\
                alert('\uc0\u12377 \u12409 \u12390 \u12398 \u36074 \u21839 \u12434 \u20351 \u12356 \u20999 \u12426 \u12414 \u12375 \u12383 \u65281 \u12522 \u12475 \u12483 \u12488 \u12508 \u12479 \u12531 \u12434 \u25276 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 ');\
                return;\
            \}\
            \
            bot.currentQuestion = question;\
            bot.conversationTurn = 0;\
            bot.resetConversation();\
            bot.allAskedQuestions.add(question);\
            \
            questionCard.textContent = bot.currentQuestion;\
            questionCard.style.pointerEvents = 'none';\
            \
            // \uc0\u26368 \u21021 \u12398 \u36074 \u21839 \u12434 \u23653 \u27508 \u12395 \u36861 \u21152 \
            bot.conversationHistory.push(\{\
                question: question,\
                answer: null\
            \});\
            \
            addMessage(bot.currentQuestion, 'bot');\
            \
            userInput.disabled = false;\
            sendBtn.disabled = false;\
            userInput.focus();\
            \
            updateProgress();\
        \});\
        \
        function addMessage(message, sender) \{\
            const messageDiv = document.createElement('div');\
            messageDiv.className = `message $\{sender\}-message`;\
            messageDiv.textContent = message;\
            chatArea.appendChild(messageDiv);\
            chatArea.scrollTop = chatArea.scrollHeight;\
        \}\
        \
        function sendMessage() \{\
            const message = userInput.value.trim();\
            if (message === '') return;\
            \
            addMessage(message, 'user');\
            userInput.value = '';\
            \
            setTimeout(() => \{\
                const response = bot.generateResponse(message);\
                addMessage(response, 'bot');\
                \
                if (bot.conversationTurn >= bot.maxTurns) \{\
                    userInput.disabled = true;\
                    sendBtn.disabled = true;\
                    newTopicBtn.style.display = 'block';\
                \}\
            \}, 1000);\
        \}\
        \
        sendBtn.addEventListener('click', sendMessage);\
        userInput.addEventListener('keypress', (e) => \{\
            if (e.key === 'Enter') \{\
                sendMessage();\
            \}\
        \});\
        \
        newTopicBtn.addEventListener('click', () => \{\
            chatArea.innerHTML = '';\
            \
            const progress = bot.getProgress();\
            if (progress.remaining > 0) \{\
                questionCard.textContent = '\uc0\u12463 \u12522 \u12483 \u12463 \u12375 \u12390 \u36074 \u21839 \u12459 \u12540 \u12489 \u12434 \u24341 \u12367 \u65281 ';\
                questionCard.style.pointerEvents = 'auto';\
            \}\
            \
            newTopicBtn.style.display = 'none';\
            userInput.disabled = true;\
            sendBtn.disabled = true;\
            bot.resetConversation();\
        \});\
        \
        resetBtn.addEventListener('click', () => \{\
            if (confirm('\uc0\u26412 \u24403 \u12395 \u12377 \u12409 \u12390 \u12398 \u36074 \u21839 \u12434 \u12522 \u12475 \u12483 \u12488 \u12375 \u12414 \u12377 \u12363 \u65311 ')) \{\
                bot.resetQuestions();\
                chatArea.innerHTML = '';\
                questionCard.textContent = '\uc0\u12463 \u12522 \u12483 \u12463 \u12375 \u12390 \u36074 \u21839 \u12459 \u12540 \u12489 \u12434 \u24341 \u12367 \u65281 ';\
                questionCard.style.pointerEvents = 'auto';\
                resetBtn.style.display = 'none';\
                updateProgress();\
            \}\
        \});\
    </script>\
</body>\
</html>\
}